{{define "content"}}
<script type="text/javascript" src="/static/js/category.js"></script>
<script type="text/javascript" src="/static/js/imageUpload.js"></script>
<h1>商品を編集する</h1>
<div>
  <input type="file" id="inputFile" placeholder="写真を追加" onchange="OutputImage(this);" />
    <button type="button" class="btn btn-primary main-btn" id="uploadFile">写真を登録する</button>
  <img src="{{.PhotoURL}}" alt="{{.Title}}" class="img img-edited">
  <div id="samplePhotoURL">
  </div>
</div>
<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.9.2/firebase-app.js';
  import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/9.9.2/firebase-storage.js';
  const firebaseConfig = {
    apiKey: "AIzaSyC08wZzoDB-TojuqkdjM4S3h-TtGNLf7gI",
    authDomain: "prac-ec.firebaseapp.com",
    projectId: "prac-ec",
    storageBucket: "prac-ec.appspot.com",
    messagingSenderId: "216459314207",
    appId: "1:216459314207:web:55ad381c9131426971012a"
  };
  const app = initializeApp(firebaseConfig);
  const storage = getStorage(app);
  
  
  document.getElementById("uploadFile").addEventListener("click", function() {
    var files = document.getElementById("inputFile").files;
    
    var image = files[0];
    
    const storageRef = ref(storage, "images/" + image.name);

    function uploadFile() {
      return new Promise((resolve) => {
          uploadBytes(storageRef, image).then((snapshot) => {
        alert('アップロードできました')
        resolve()
      })
      });
    }

    async function imageDownload() {
      await uploadFile();
      
       getDownloadURL(ref(storage, "images/" + image.name))
      .then((url) => {
        const input = document.getElementById('editImg');
        input.setAttribute('value', url);
      })
    }
    imageDownload();
  })
  
</script>
<form role="form" action="/items/update/{{.ID}}" method="post">
</br>
  </br>
    <div class="form-group">
    <textarea class="form-control" name="title" placeholder="商品タイトルを編集" rows="1">{{.Title}}</textarea>
    </br>
    <textarea class="form-control" name="content" placeholder="商品概要を編集" rows="4">{{.Content}}</textarea>
    </br>
  </br>
    <div>
      <select name="category_first" class="select select_child">
        <option hidden class="category_first">{{.CategoryFirst}}</option>
        <option value="0">テント・タープ</option>
        <option value="1">チェア・テーブル</option>
        <option value="2">セット用品</option>
        <option value="3">調理用品</option>
        <option value="4">寝袋・マット</option>
        <option value="5">ランタン</option>
        <option value="6">クーラーボックス</option>
        <option value="7">焚き火</option>
        <option value="8">その他</option>
      </select>
      <select name="category_second" class="select select_child">
        <option hidden class="category_second">{{.CategorySecond}}</option>
        <option value="0">テント・タープ</option>
        <option value="1">チェア・テーブル</option>
        <option value="2">セット用品</option>
        <option value="3">調理用品</option>
        <option value="4">寝袋・マット</option>
        <option value="5">ランタン</option>
        <option value="6">クーラーボックス</option>
        <option value="7">焚き火</option>
        <option value="8">その他</option>
      </select>
      <select name="category_third" class="select select_child">
        <option hidden class="category_third">{{.CategoryThird}}</option>
        <option value="0">テント・タープ</option>
        <option value="1">チェア・テーブル</option>
        <option value="2">セット用品</option>
        <option value="3">調理用品</option>
        <option value="4">寝袋・マット</option>
        <option value="5">ランタン</option>
        <option value="6">クーラーボックス</option>
        <option value="7">焚き火</option>
        <option value="8">その他</option>
      </select>
    </div>
  </br>
  <div>
    <input type="number" min="100" step="10" name="price" placeholder="商品価格を追加">
  </div>
  </br>
  <input type="hidden" name="photo_url" id="editImg" value="">
    <button class="btn btn-lg btn-primary pull-right main-btn" type="submit">編集</button>
    </div>
</form> 
<div>
  <a href="/items/delete/{{.ID}}" onclick="return confirm('削除しますか')">
    <button type="button" class ="btn main-btn navbar-right confirmDelete">削除</button>
  </a>
</div>
{{end}}